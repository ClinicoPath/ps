<svg #plot
  [style.fontFamily]="plotOptions.fontFamily"
  [style.fontSize]="(plotOptions.fontSize * 110).toString() + '%'"
  [attr.class]="name" [attr.width]="fixedWidth" [attr.height]="fixedHeight">

  <rect #unit x="0" y="0" width="1em" height="1em" stroke="none" fill="none" />
  <ng-template [ngIf]="groups && modelSet">
    <defs>
      <clipPath id="{{name}}-plot-area">
        <rect x="0" y="0" [attr.width]="innerWidth" [attr.height]="innerHeight" />
      </clipPath>
    </defs>

    <text text-anchor="middle"
      [attr.x]="innerWidth / 2 + margin" [attr.y]="innerHeight + margin" dy="2.5em">
      Parameter Space
    </text>
    <text text-anchor="middle" font-weight="bold"
      [attr.x]="innerWidth / 2 + margin" y="0" dy="2em">
      {{title}}
    </text>

    <!-- alternate groups -->
    <g *ngFor="let group of groups; let i = index; trackBy: trackByIndex"
      [attr.transform]="translate(margin, margin)">

      <path id="{{name}}-group-{{i}}-dist"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.fill]="getColor(groups.length - i)"
        stroke="none" opacity="0.5" />

      <path id="{{name}}-group-{{i}}-center"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <path id="{{name}}-group-{{i}}-left"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <path id="{{name}}-group-{{i}}-right"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <circle id="{{name}}-group-{{i}}-target"
        attr.clip-path="url(#{{name}}-plot-area)"
        r="5"
        [attr.fill]="getColor(groups.length - i)" />
    </g>

    <!-- main group -->
    <g [attr.transform]="translate(margin + targetTranslateOffset, margin)">
      <path id="{{name}}-main-dist"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.fill]="getColor(0)"
        stroke="none" [attr.opacity]="targetDragging ? 0.1 : 0.5" />

      <path id="{{name}}-main-center"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        fill="none" />

      <path #leftBar id="{{name}}-main-left" class="bar"
        [class.drag-disabled]="disableDragCI"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 4"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        [attr.transform]="translate(barTranslateOffset, 0)"
        fill="none"
        (mouseover)="toggleLeftBarInfo(true)"
        (mouseout)="toggleLeftBarInfo(false)" />

      <g *ngIf="showLeftBarInfo"
        [attr.transform]="translate(xScale(mainGroup.left + barOffset), yScale(0.5))">
        <path id="{{name}}-left-box"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.9" />
        <text id="{{name}}-left-coords" x="0" y="-3em" font-family="mono" text-anchor="middle">
          <tspan style="white-space: pre">{{mainGroup.label}}: {{ciWidth() | formatFixed:[mainGroup.left]}}</tspan><tspan x="0" dy="1em" style="white-space: pre">Bound:  {{mainGroup.left | formatFixed:[ciWidth()]}}</tspan>
        </text>
      </g>

      <path #rightBar id="{{name}}-main-right" class="bar"
        [class.drag-disabled]="disableDragCI"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 4"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        [attr.transform]="translate(-barTranslateOffset, 0)"
        fill="none"
        (mouseover)="toggleRightBarInfo(true)"
        (mouseout)="toggleRightBarInfo(false)" />

      <g *ngIf="showRightBarInfo"
        [attr.transform]="translate(xScale(mainGroup.right - barOffset), yScale(0.5))">
        <path id="{{name}}-right-box"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.9" />
        <text id="{{name}}-right-coords" x="0" y="-3em" font-family="mono" text-anchor="middle">
          <tspan style="white-space: pre">{{mainGroup.label}}: {{ciWidth() | formatFixed:[mainGroup.right]}}</tspan><tspan x="0" dy="1em" style="white-space: pre">Bound:  {{mainGroup.right | formatFixed:[ciWidth()]}}</tspan>
        </text>
      </g>

      <g *ngIf="showTargetInfo"
        [attr.transform]="translate(xScale(mainGroup.target), yScale(0.5))">
        <path id="{{name}}-target-box"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.9" />
        <text id="{{name}}-target-coords" x="0" y="-1.5em" font-family="mono" text-anchor="middle">
          <tspan style="white-space: pre">&delta;: {{mainGroup.target + targetOffset | formatFixed:[]}}</tspan>
        </text>
      </g>

      <circle #target id="{{name}}-main-target" class="target"
        [class.drag-disabled]="disableDragTarget"
        attr.clip-path="url(#{{name}}-plot-area)"
        r="5"
        [attr.fill]="getColor(0)"
        (mouseover)="toggleTargetInfo(true)"
        (mouseout)="toggleTargetInfo(false)" />
    </g>

    <circle r="5"
      [attr.cx]="xScale(0)"
      [attr.cy]="yScale(0.5)"
      attr.clip-path="url(#{{name}}-plot-area)"
      [attr.transform]="translate(margin, margin)"
      fill="darkseagreen" />

    <g id="{{name}}-bottom-axis" [attr.transform]="translate(margin, innerHeight + margin)"></g>
  </ng-template>
</svg>
