<svg #plot
  [style.fontFamily]="plotOptions.fontFamily"
  [style.fontSize]="(plotOptions.fontSize * 110).toString() + '%'"
  [attr.class]="name" [attr.width]="fixedWidth" [attr.height]="fixedHeight">

  <rect #unit x="0" y="0" width="1em" height="1em" stroke="none" fill="none" />
  <ng-template [ngIf]="groups && modelSet">
    <defs>
      <clipPath [id]="clipPathId">
        <rect x="0" y="0" [attr.width]="innerWidth" [attr.height]="innerHeight" />
      </clipPath>
    </defs>

    <text text-anchor="middle"
      [attr.x]="innerWidth / 2 + margin" [attr.y]="innerHeight + margin" dy="2.5em">
      Parameter Space
    </text>
    <text text-anchor="middle" font-weight="bold"
      [attr.x]="innerWidth / 2 + margin" y="0" dy="2em">
      {{title}}
    </text>

    <!-- alternate groups -->
    <g *ngFor="let group of groups; let i = index"
      [attr.transform]="translate(margin, margin)">

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="group.distPath"
        [attr.fill]="getColor(groups.length - i)"
        stroke="none" opacity="0.5" />

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="group.centerPath"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="group.leftPath"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="group.rightPath"
        [attr.stroke]="getColor(groups.length - i)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        fill="none" />

      <circle r="5"
        [attr.cx]="xScale(group.target)"
        [attr.cy]="yScale(0.5)"
        [attr.clip-path]="clipPath()"
        [attr.fill]="getColor(groups.length - i)" />
    </g>

    <!-- main group -->
    <g [attr.transform]="translate(margin + targetTranslateOffset, margin)">

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="mainGroup.distPath"
        [attr.fill]="getColor(0)"
        stroke="none" [attr.opacity]="targetDragging ? 0.1 : 0.5" />

      <path
        [attr.clip-path]="clipPath()"
        [attr.d]="mainGroup.centerPath"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        fill="none" />

      <path #leftBar class="bar"
        [attr.clip-path]="clipPath()"
        [attr.d]="mainGroup.leftPath"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 4"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        [attr.transform]="translate(barTranslateOffset, 0)"
        fill="none"
        (mouseover)="toggleLeftBarInfo(true)"
        (mouseout)="toggleLeftBarInfo(false)" />

      <g *ngIf="showLeftBarInfo"
        [attr.transform]="translate(xScale(mainGroup.left + barOffset) - (4 * unitLength), yScale(0.5))">
        <rect x="0" y="-3.5em" width="8em" height="1.5em"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.9" />
        <text x="1em" y="-2.5em">95% CI: {{ciWidth() | round}}</text>
      </g>

      <path #rightBar class="bar"
        [attr.clip-path]="clipPath()"
        [attr.d]="mainGroup.rightPath"
        [attr.stroke]="getColor(0)"
        [attr.stroke-width]="plotOptions.lineWidth * 4"
        [attr.opacity]="targetDragging ? 0.1 : 0.9"
        [attr.transform]="translate(-barTranslateOffset, 0)"
        fill="none"
        (mouseover)="toggleRightBarInfo(true)"
        (mouseout)="toggleRightBarInfo(false)" />

      <g *ngIf="showRightBarInfo"
        [attr.transform]="translate(xScale(mainGroup.right - barOffset) - (4 * unitLength), yScale(0.5))">
        <rect x="0" y="-3.5em" width="8em" height="1.5em"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.9" />
        <text x="1em" y="-2.5em">95% CI: {{ciWidth() | round}}</text>
      </g>

      <g *ngIf="showTargetInfo"
        [attr.transform]="translate(xScale(mainGroup.target), yScale(0.5))">
        <rect x="0" y="-3.5em" width="6em" height="1.5em"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.8" />
        <text x="1em" y="-3.5em">
          <tspan dy="1em" text-anchor="right">&delta;:</tspan>
          <tspan x="2.5em" text-anchor="left">{{(mainGroup.target + targetOffset) | round}}</tspan>
        </text>
      </g>

      <circle #target class="target" r="5"
        [attr.cx]="xScale(mainGroup.target)"
        [attr.cy]="yScale(0.5)"
        [attr.clip-path]="clipPath()"
        [attr.fill]="getColor(0)"
        (mouseover)="toggleTargetInfo(true)"
        (mouseout)="toggleTargetInfo(false)" />
    </g>

    <circle r="5"
      [attr.cx]="xScale(0)"
      [attr.cy]="yScale(0.5)"
      [attr.clip-path]="clipPath()"
      [attr.transform]="translate(margin, margin)"
      fill="darkseagreen" />

    <g #bottomAxis [attr.transform]="translate(margin, innerHeight + margin)"></g>
  </ng-template>
</svg>
