<svg #plot
  [style.fontFamily]="plotOptions.fontFamily == '' ? null : plotOptions.fontFamily"
  [style.fontSize]="(plotOptions.fontSize * 110).toString() + '%'"
  [attr.class]="name" [attr.width]="fixedWidth" [attr.height]="fixedHeight">

  <rect #unit x="0" y="0" width="1em" height="1em" stroke="none" fill="none" />
  <ng-template [ngIf]="x && y && modelSet">
    <defs>
      <clipPath id="{{name}}-plot-area">
        <rect x="0" [attr.y]="-plotOptions.lineWidth * 3"
          [attr.width]="innerWidth"
          [attr.height]="innerHeight + plotOptions.lineWidth * 3" />
      </clipPath>
      <clipPath id="{{name}}-target-area">
        <rect x="-5" [attr.y]="-5"
          [attr.width]="innerWidth + 10"
          [attr.height]="innerHeight + 10" />
      </clipPath>
    </defs>

    <text text-anchor="middle"
      [attr.x]="innerWidth / 2 + margin" [attr.y]="innerHeight + margin" dy="2.5em">
      {{x.title}}
    </text>
    <text text-anchor="middle"
      [attr.dx]="-(innerHeight / 2 + margin)" dy="1em"
      transform="rotate(-90)">
      {{y.title}}
    </text>
    <text text-anchor="middle" font-weight="bold"
      [attr.x]="innerWidth / 2 + margin" y="0" dy="2em">
      {{title}}
    </text>

    <g *ngIf="paths.length > 0"
      [attr.transform]="translate(margin, margin)">
      <path
        id="{{name}}-path-0"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="palette.getColor(paths.length - 1, plotOptions.paletteTheme)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.stroke-dasharray]="plotOptions.dashArray()"
        [attr.stroke-linecap]="plotOptions.lineCap()"
        [attr.opacity]="(paths.length - 1) == 0 ? 1 : 0.7"
        fill="none" />
    </g>

    <g *ngIf="paths.length > 1"
      [attr.transform]="translate(margin, margin)">
      <path
        id="{{name}}-path-1"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="palette.getColor(paths.length - 2, plotOptions.paletteTheme)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.stroke-dasharray]="plotOptions.dashArray()"
        [attr.stroke-linecap]="plotOptions.lineCap()"
        [attr.opacity]="(paths.length - 1) == 1 ? 1 : 0.7"
        fill="none" />
    </g>

    <g *ngIf="paths.length > 2"
      [attr.transform]="translate(margin, margin)">
      <path
        id="{{name}}-path-2"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="palette.getColor(paths.length - 3, plotOptions.paletteTheme)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.stroke-dasharray]="plotOptions.dashArray()"
        [attr.stroke-linecap]="plotOptions.lineCap()"
        [attr.opacity]="(paths.length - 1) == 2 ? 1 : 0.7"
        fill="none" />
    </g>

    <g *ngIf="paths.length > 3"
      [attr.transform]="translate(margin, margin)">
      <path
        id="{{name}}-path-3"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="palette.getColor(paths.length - 4, plotOptions.paletteTheme)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.stroke-dasharray]="plotOptions.dashArray()"
        [attr.stroke-linecap]="plotOptions.lineCap()"
        [attr.opacity]="(paths.length - 1) == 3 ? 1 : 0.7"
        fill="none" />
    </g>

    <g *ngIf="paths.length > 4"
      [attr.transform]="translate(margin, margin)">
      <path
        id="{{name}}-path-4"
        attr.clip-path="url(#{{name}}-plot-area)"
        [attr.stroke]="palette.getColor(paths.length - 5, plotOptions.paletteTheme)"
        [attr.stroke-width]="plotOptions.lineWidth * 3"
        [attr.stroke-dasharray]="plotOptions.dashArray()"
        [attr.stroke-linecap]="plotOptions.lineCap()"
        [attr.opacity]="(paths.length - 1) == 4 ? 1 : 0.7"
        fill="none" />
    </g>

    <ng-template [ngIf]="!hideDropLines">
      <g [attr.transform]="translate(margin, margin)">
        <path id="{{name}}-drop-0"
          attr.clip-path="url(#{{name}}-plot-area)"
          stroke="red"
          [attr.stroke-width]="plotOptions.lineWidth * 3 / 2"
          stroke-dasharray="5, 5"
          fill="none" />
      </g>

      <g [attr.transform]="translate(margin, margin)">
        <path id="{{name}}-drop-1"
          attr.clip-path="url(#{{name}}-plot-area)"
          stroke="red"
          [attr.stroke-width]="plotOptions.lineWidth * 3 / 2"
          stroke-dasharray="5, 5"
          fill="none" />
      </g>
    </ng-template>

    <g id="{{name}}-x-axis" [attr.transform]="translate(margin, innerHeight + margin)"></g>
    <g id="{{name}}-y-axis" [attr.transform]="translate(margin, margin)"></g>

    <g *ngIf="showHoverInfo"
      [attr.transform]="translate(margin + hoverX, margin + hoverY)">
      <circle r="4" fill="none" stroke="blue" />
      <rect x="-3.5em" [attr.y]="hoverInfoY()" width="8em" height="2.5em"
        stroke="black" stroke-width="1" fill="white" fill-opacity="0.8" />
      <text x="-2.5em" [attr.y]="hoverInfoY()">
        <tspan dy="1em" text-anchor="right">{{x.sym}}:</tspan>
        <tspan x="0em" text-anchor="left">{{hoverPoint.x}}</tspan>
        <tspan x="-2.5em" dy="1em" text-anchor="right">{{y.sym}}:</tspan>
        <tspan x="0em" text-anchor="left">{{hoverPoint.y}}</tspan>
      </text>
    </g>

    <ng-template [ngIf]="!hideTarget">
      <rect [attr.transform]="translate(margin, margin)"
        [attr.width]="innerWidth" [attr.height]="innerHeight"
        fill="none" pointer-events="all"
        (mouseout)="toggleHoverInfo(false)"
        (mousemove)="hover($event)" />

      <g *ngIf="showTargetInfo"
        [attr.transform]="translate(margin + xScale(targetPoint.x), margin + yScale(targetPoint.y))">
        <rect x="0" y="-3.5em" width="8em" height="2.5em"
          stroke="black" stroke-width="1" fill="white" fill-opacity="0.8" />
        <text x="1em" y="-3.5em">
          <tspan dy="1em" text-anchor="right">{{x.sym}}:</tspan>
          <tspan x="3.5em" text-anchor="left">{{targetPoint.x}}</tspan>
          <tspan x="1em" dy="1em" text-anchor="right">{{y.sym}}:</tspan>
          <tspan x="3.5em" text-anchor="left">{{targetPoint.y}}</tspan>
        </text>
      </g>

      <circle #target class="target" r="5"
        [attr.transform]="translate(margin, margin)"
        attr.clip-path="url(#{{name}}-target-area)"
        fill="red"
        (mouseover)="toggleTargetInfo(true)"
        (mouseout)="toggleTargetInfo(false)" />
    </ng-template>
  </ng-template>
</svg>
